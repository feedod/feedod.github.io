<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="description" content="–ü–æ–∏—Å–∫–æ–≤–∏–∫ –ø–æ –ú–∞–≥–∞–∑–∏–Ω–∞–º." />
  <meta name="color-scheme" content="light dark" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self';
    style-src 'self' 'unsafe-inline';
    connect-src 'self';
    img-src 'self' data:;
    base-uri 'none';
    form-action 'self';
    frame-ancestors 'none';
  " />
  <title>–ü–æ–∏—Å–∫–æ–≤–∏–∫ –ø–æ –ú–∞–≥–∞–∑–∏–Ω–∞–º</title>

  <style>
    /* Minimal modern reset */
    :where(html,body){height:100%}
    *,*::before,*::after{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font: 16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: color-mix(in oklab, #f6f7fb 70%, white);
      color: #0f172a;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:clamp(12px,2vw,24px);
    }

    @media (prefers-color-scheme: dark){
      body{
        background: linear-gradient(180deg,#071023 0%, #0b1220 100%);
        color:#e6eef8;
      }
    }

    :root{
      --radius:12px;
      --surface: #ffffff;
      --muted: #6b7280;
      --accent: #2563eb;
      --accent-2: #3b82f6;
      --card-bg: color-mix(in oklab, var(--surface) 88%, var(--accent) 2%);
      --shadow: 0 10px 30px rgba(2,6,23,.08);
    }

    @media (prefers-color-scheme: dark){
      :root{
        --surface:#0f172a;
        --muted:#9aa4b2;
        --accent:#60a5fa;
        --accent-2:#93c5fd;
        --card-bg: color-mix(in oklab, var(--surface) 90%, var(--accent) 4%);
        --shadow: 0 10px 30px rgba(0,0,0,.5);
      }
    }

    /* Reduced motion respect */
    @media (prefers-reduced-motion: reduce){
      * { transition: none !important; animation: none !important; scroll-behavior: auto !important; }
    }

    /* Container */
    .sheet{
      width:min(960px,100%);
      max-width:760px;
      background:var(--surface);
      border-radius:calc(var(--radius) + 2px);
      padding:clamp(18px,3.2vw,28px);
      box-shadow:var(--shadow);
      display:flex;
      gap:clamp(12px,2vw,18px);
      flex-direction:column;
      align-items:stretch;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }

    h1{
      font-size:clamp(1.1rem,1.6vw,1.6rem);
      margin:0;
      color:var(--accent);
      letter-spacing:-0.01em;
      font-weight:700;
    }

    /* Theme toggle */
    .controls-row{
      display:flex;
      gap:.5rem;
      align-items:center;
    }
    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.5rem;
      border:0;
      background:transparent;
      color:inherit;
      padding:.45rem .65rem;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      transition:background .14s ease, transform .08s ease;
    }
    .btn:active{ transform:translateY(1px) }

    .theme-btn{
      border:1px solid color-mix(in oklab, var(--muted) 30%, transparent);
      padding:.35rem .55rem;
      font-size:.95rem;
      background:transparent;
    }

    /* Form */
    form{ display:flex; gap:.6rem; align-items:center; margin-top:4px; flex-wrap:wrap }
    select{
      flex:1 1 0;
      min-width:180px;
      padding:.75rem 1rem;
      font-size:1rem;
      border-radius:10px;
      border:1.5px solid color-mix(in oklab, var(--muted) 20%, transparent);
      background:var(--surface);
      color:inherit;
      outline:none;
    }
    select:focus{
      box-shadow:0 0 0 4px color-mix(in oklab, var(--accent) 18%, transparent);
      border-color:var(--accent-2);
    }
    .search-btn{
      background:var(--accent);
      color: #fff;
      padding:.75rem 1rem;
      border-radius:10px;
      border:0;
      font-weight:700;
    }
    .search-btn:hover{ background:var(--accent-2) }

    /* Results */
    .results{ display:flex; flex-direction:column; gap:.75rem; margin-top:.5rem; max-height:44vh; overflow:auto; padding-right:4px }
    .card{
      background:var(--card-bg);
      border-radius:10px;
      padding:.85rem 1rem;
      box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 12%, transparent);
    }
    .meta{ color:var(--muted); font-size:.92rem }

    /* Small screens */
    @media (max-width:520px){
      .sheet{ padding:16px }
      form{ gap:.4rem }
      .search-btn{ padding:.6rem .8rem }
    }
  </style>
</head>
<body>
  <main class="sheet" id="app">
    <a href="#main-search" class="visually-hidden" style="position:absolute;left:-9999px;top:auto;overflow:hidden">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∏—Å–∫—É</a>

    <header>
      <h1>–ü–æ–∏—Å–∫–æ–≤–∏–∫ –ø–æ –ú–∞–≥–∞–∑–∏–Ω–∞–º</h1>
      <div class="controls-row" aria-hidden="false">
        <button class="btn theme-btn" id="themeToggle" aria-pressed="false" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåì</button>
      </div>
    </header>

    <section id="main-search" aria-labelledby="search-label">
      <label id="search-label" class="visually-hidden">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω</label>
      <form id="searchForm" action="#" onsubmit="return false;">
        <select id="shopSelect" name="shop" aria-label="–°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤">
          <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω ‚Äî</option>
        </select>
        <button type="submit" id="searchBtn" class="btn search-btn" aria-label="–ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω">–ü–æ–∏—Å–∫</button>
      </form>

      <div id="results" class="results" aria-live="polite" aria-atomic="true"></div>
    </section>
  </main>

  <script>
    // Modern, minimal, robust code (ES2025 idioms)
    const SELECT = document.getElementById('shopSelect');
    const RESULTS = document.getElementById('results');
    const FORM = document.getElementById('searchForm');
    const THEME_TOGGLE = document.getElementById('themeToggle');
    const SEARCH_BTN = document.getElementById('searchBtn');

    // Utils
    const $ = sel => document.querySelector(sel);
    const el = (tag, props = {}, children = []) => {
      const node = document.createElement(tag);
      Object.assign(node, props);
      (Array.isArray(children) ? children : [children]).forEach(c => {
        if (c == null) return;
        node.append(typeof c === 'string' ? document.createTextNode(c) : c);
      });
      return node;
    };

    // Theme: prefer saved > system
    (function initTheme(){
      try {
        const saved = localStorage.getItem('theme');
        if (saved === 'dark' || (!saved && window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches)) {
          document.documentElement.classList.add('dark');
          THEME_TOGGLE.setAttribute('aria-pressed','true');
        } else {
          THEME_TOGGLE.setAttribute('aria-pressed','false');
        }
      } catch {}
    })();

    THEME_TOGGLE.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      try { localStorage.setItem('theme', isDark ? 'dark' : 'light'); } catch {}
      THEME_TOGGLE.setAttribute('aria-pressed', String(isDark));
      THEME_TOGGLE.blur();
    });

    // Fetch with AbortController + timeout
    async function fetchJson(url, ms = 12000) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), ms);
      try {
        const res = await fetch(url, { signal: controller.signal, cache: 'no-store' });
        clearTimeout(timeout);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return await res.json();
      } finally {
        clearTimeout(timeout);
      }
    }

    // Populate select with data (expects array of {num,name,territory})
    function populateSelect(list = []) {
      // clear existing dynamic options
      [...SELECT.options].slice(1).forEach(o => o.remove());
      const fragment = document.createDocumentFragment();
      for (const it of list) {
        // Normalize
        const num = String(it?.num ?? '').trim();
        const name = String(it?.name ?? '').trim();
        const territory = String(it?.territory ?? '').trim();
        if (!num || !name) continue;
        const option = el('option', { value: num });
        option.textContent = `${num}: ${name}`;
        option.dataset.territory = territory;
        fragment.appendChild(option);
      }
      SELECT.appendChild(fragment);
    }

    // Render result card
    function renderResult({ num, name, territory }) {
      RESULTS.innerHTML = '';
      const card = el('div', { className: 'card' }, [
        el('div', {}, [
          el('div', {}, `–ù–æ–º–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞: ${num}`),
          el('div', { className: 'meta' }, `–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è: ${territory || '‚Äî'}`),
          el('div', { className: 'meta' }, `–ê–¥—Ä–µ—Å: ${name}`)
        ])
      ]);
      RESULTS.appendChild(card);
      // move focus to results for screen readers
      card.setAttribute('tabindex','-1');
      card.focus({ preventScroll: true });
    }

    // No-JS fallback note (progressive enhancement)
    RESULTS.innerHTML = '<div class="meta">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤‚Ä¶</div>';

    // Load data.json only (user requested remove text.txt)
    (async function init() {
      try {
        const data = await fetchJson('data.json', 12000);
        if (!Array.isArray(data)) throw new TypeError('–û–∂–∏–¥–∞–ª—Å—è –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤');
        populateSelect(data);
        RESULTS.innerHTML = '<div class="meta">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü–æ–∏—Å–∫¬ª.</div>';
      } catch (err) {
        console.error(err);
        RESULTS.innerHTML = '<div class="meta" role="alert">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ data.json.</div>';
      }
    })();

    // Handle form submit
    FORM.addEventListener('submit', (ev) => {
      ev.preventDefault();
      const idx = SELECT.selectedIndex;
      const opt = SELECT.options[idx];
      if (!opt || !opt.value) {
        RESULTS.innerHTML = '<div class="meta">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω.</div>';
        SELECT.focus();
        return;
      }
      renderResult({ num: opt.value, name: opt.textContent.replace(/^\d+:\s*/,'') , territory: opt.dataset.territory });
    });

    // Enter on select triggers search (accessibility)
    SELECT.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        SEARCH_BTN.click();
      }
    });

    // Expose minimal globals for debugging only in non-production
    try {
      if (window.location.hostname === 'localhost') {
        window._shopDebug = { populateSelect, renderResult, fetchJson };
      }
    } catch {}
  </script>

  <!-- Minimal visually-hidden utility -->
  <style>
    .visually-hidden{
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px,1px,1px,1px);
      white-space: nowrap;
      border: 0; padding: 0; margin: -1px;
    }
  </style>
</body>
</html>